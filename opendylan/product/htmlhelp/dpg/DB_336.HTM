<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- Generated by Harlequin WebMaker 3.0.2 ( 8-May-1997 experimental) -->
<HEAD>
<LINK REL=TOP HREF="DB_1.HTM">
<LINK REL=UP HREF="DB_329.HTM">
<LINK REL=PREV HREF="DB_335.HTM">
<LINK REL=NEXT HREF="DB_337.HTM">
<TITLE>21.7   Auxiliary macros</TITLE>
<META NAME=GENERATOR CONTENT="Harlequin WebMaker 3.0.2 ( 8-May-1997 experimental)">
</HEAD>
<BODY BGCOLOR="#FFFFFF">

<DIV>
<A NAME=HEADING336></A>

<DIV>
<P><A HREF="DB_337.HTM"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="DB_335.HTM"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="DB_1.HTM"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="DB_2.HTM"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="DB_349.HTM"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>

</DIV>
<A NAME=HEADING336-0></A>
<H1>21.7   Auxiliary <A NAME=MARKER-2-880></A>macros</H1>
<P> One difficulty with the aircraft macro that we defined in <A HREF="DB_334.HTM#MARKER-9-876">Section 21.5</A> is this: suppose that we want each flight object to know the type of equipment used, rather than our having to look up the type in the aircraft registry. What looks like the obvious approach does not work:</P>
<PRE>
define macro aircraft-definer
  { define aircraft ?identifier:name (?type:name) ?flights end }
   =&gt; { register-aircraft(make(&quot;&lt;&quot; ## ?type ## &quot;&gt;&quot;, id: ?#&quot;identifier&quot;));
        register-flights(?#&quot;identifier&quot;, ?flights) }
flights:
  { }
   =&gt; { }
  { ?flight; ... }
   =&gt; { ?flight, ... }
flight:
  { }
   =&gt; { }
  { flight ?id:name, #rest ?options:expression }
   =&gt; { make(&lt;flight&gt;, equipment: ?&quot;type&quot;, id: ?#&quot;id&quot;, ?options) }
end macro aircraft-definer;
</PRE>
<P> When we are processing the <CODE>flight</CODE> auxiliary rules, we would like to be able to reference the pattern variable <CODE>?type</CODE> (coercing it to a string) from the main rules, but it is not <B>in scope</B> -- it is inaccessible to the auxiliary rules. We could have <BR><CODE>register-flights</CODE> set the <CODE>equipment</CODE> slot after the flight is created, but we would prefer to initialize the slot at the time we create the <CODE>&lt;flight&gt;</CODE> object. There is a workaround, an <B>auxiliary macro</B>:</P>
<PRE>
define macro aircraft-definer
  { define aircraft ?identifier:name (?type:name) ?flights:* end }
   =&gt; { register-aircraft (make(&quot;&lt;&quot; ## ?type ## &quot;&gt;&quot;, id: ?#&quot;identifier&quot;));
        define flights (?#&quot;identifier&quot;, ?&quot;type&quot;)
          ?flights
        end }
end macro aircraft-definer;
define macro flights-definer
  { define flights (?craft:name, ?equipment:name) end }
   =&gt; { }
  { define flights (?craft:name, ?equipment:name) ?flight ; ?more:* end }
   =&gt; { register-flights
          (?craft, make(&lt;flight&gt;, equipment: ?equipment, ?flight)) ;
        define flights (?craft, ?equipment) ?more end }
flight:
  { }
   =&gt; { }
  { flight ?id:name, #rest ?options:expression }
   =&gt; { id: ?#&quot;id&quot;, ?options }
end macro flights-definer;
</PRE>
<P> Here, we have essentially broken out the work that used to be done by the auxiliary rule <CODE>flights</CODE> into a separate definition macro. Where <CODE>flights</CODE> used points of ellipsis to walk over each flight, the definition macro uses a <B>wildcard</B> constraint <CODE>?more:*</CODE>, explicitly calling itself again (that is, the macro appears in the substitution, and will be expanded again), as long as there are more flights to be <BR>processed.</P>
<P>Here is an example use of the <CODE>flights-definer</CODE> macro:</P>
<PRE>
define aircraft UA4906H (DC10)
  flight UA11 from: #&quot;BOS&quot;, to: #&quot;SFO&quot;;
  flight UA12 from: #&quot;SFO&quot;, to: #&quot;BOS&quot;;
end aircraft UA4906H;
</PRE>
<P> Expanding that code would result in the following:</P>
<PRE>
<EM>register-aircraft (make(</EM>&lt;DC10&gt;<EM>, </EM>#&quot;UA4096H&quot;<EM>));
register-flights (</EM>#&quot;UA4096H&quot;<EM>,
</EM>                  <EM>make(&lt;flight&gt;, equipment: </EM>&quot;DC10&quot;<EM>,
</EM>                       <EM>id: </EM>#&quot;UA11&quot;<EM> </EM>from: #&quot;BOS&quot;, to: #&quot;SFO&quot;<EM>);
register-flights (</EM>#&quot;UA4096H&quot;<EM>,
</EM>                  <EM>make(&lt;flight&gt;, equipment: </EM>&quot;DC10&quot;<EM>,
</EM>                       <EM>id: </EM>#&quot;UA12&quot;<EM> </EM>from: #&quot;SFO&quot;, to: #&quot;BOS&quot;<EM>);</EM>
</PRE>
<P> (Note that this example is a hypothetical one used to illustrate macro expansion. The <CODE>define aircraft</CODE> statement cannot be compiled in the airport example.)</P>

</DIV>

<DIV>

<DIV>

<!-- TOC -->

</DIV>

<HR>
<ADDRESS>Dylan Programming - 9 Apr 1999</ADDRESS>
<P><A HREF="DB_337.HTM"><IMG ALIGN=BOTTOM SRC=next.gif ALT=Next BORDER=0></A> <A HREF="DB_335.HTM"><IMG ALIGN=BOTTOM SRC=prev.gif ALT=Previous BORDER=0></A> <A HREF="DB_1.HTM"><IMG ALIGN=BOTTOM SRC=top.gif ALT=Top BORDER=0></A> <A HREF="DB_2.HTM"><IMG ALIGN=BOTTOM SRC=content.gif ALT=Contents BORDER=0></A> <A HREF="DB_349.HTM"><IMG ALIGN=BOTTOM SRC=index.gif ALT=Index BORDER=0></A></P>
<P>N Feinberg/S E Keene/R Mathews/P Tucker Withington, DYLAN PROGRAMMING, (c) 1997 Harlequin Inc. Reproduced by permission of Addison-Wesley Longman Publishing Company, Inc.  All rights reserved. No further copying, downloading or transmitting of this material is allowed without the prior written permission of the publisher.</P>

</DIV>
</BODY>
</HTML>
